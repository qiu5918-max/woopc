---
// API é…ç½®
const API_BASE = import.meta.env.API_BASE || 'http://101.42.36.114:5919';
const SUBDOMAIN = 'www';

// ä» API è·å–åšå®¢æ•°æ®
async function getBlogs() {
  try {
    const res = await fetch(`${API_BASE}/api/v1/public/${SUBDOMAIN}/blogs`, {
      headers: { 'Content-Type': 'application/json' }
    });
    if (!res.ok) return [];
    const data = await res.json();
    return data.data || [];
  } catch (error) {
    console.error('Failed to fetch blogs:', error);
    return [];
  }
}

// åˆ†ç±» emoji æ˜ å°„
const categoryEmoji: Record<string, string> = {
  'ai-enterprise': 'ğŸ¤–',
  'health-cardiovascular': 'â¤ï¸',
  'ai-health-fusion': 'ğŸ”—'
};

const apiBlogs = await getBlogs();

// å¦‚æœ API æœ‰æ•°æ®åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
const blogPosts = apiBlogs.length > 0 ? apiBlogs.map((b: any) => ({
  id: b.id,
  title: b.title,
  description: b.excerpt || '',
  category: b.category || 'ai-enterprise',
  date: b.publishedAt ? new Date(b.publishedAt).toISOString().split('T')[0] : '',
  readTime: '5åˆ†é’Ÿ',
  emoji: categoryEmoji[b.category] || 'ğŸ“'
})) : [
  {
    id: 1,
    title: 'ä¼ä¸šAIæ™ºèƒ½ä½“éƒ¨ç½²é¿å‘ï¼šåˆ«è®©æŠ€æœ¯è„±èŠ‚ä¸šåŠ¡',
    description: 'ä¼ä¸šè½åœ°AIæ™ºèƒ½ä½“æœ€å¸¸è§çš„é”™è¯¯å°±æ˜¯æŠ€æœ¯ä¸ä¸šåŠ¡è„±èŠ‚ã€‚æœ¬æ–‡åˆ†äº«5ä¸ªå®æˆ˜ç»éªŒï¼Œå¸®ä½ é¿å¼€è¿™äº›å‘ã€‚',
    category: 'ai-enterprise',
    date: '2025-01-15',
    readTime: '5åˆ†é’Ÿ',
    emoji: 'ğŸ¤–'
  },
  {
    id: 2,
    title: 'ä»0åˆ°1è½åœ°ä¼ä¸šAIæ™ºèƒ½ä½“ï¼Œè¿™5æ­¥ç¼ºä¸€ä¸å¯',
    description: 'åŸºäºå¤šä¸ªä¼ä¸šAIé¡¹ç›®è½åœ°ç»éªŒï¼Œæ€»ç»“å‡ºå®Œæ•´çš„5æ­¥è½åœ°æµç¨‹ï¼Œè®©ä¼ä¸šAIéƒ¨ç½²æœ‰ç« å¯å¾ªã€‚',
    category: 'ai-enterprise',
    date: '2025-01-10',
    readTime: '8åˆ†é’Ÿ',
    emoji: 'ğŸ“‹'
  },
  {
    id: 3,
    title: 'æ”¿ä¼å•ä½AIæ™ºèƒ½ä½“éƒ¨ç½²çš„åˆè§„ä¸è½åœ°è¦ç‚¹',
    description: 'æ”¿ä¼å•ä½éƒ¨ç½²AIæ™ºèƒ½ä½“æœ‰å“ªäº›åˆè§„è¦æ±‚ï¼Ÿæœ¬æ–‡è¯¦è§£æ•°æ®å®‰å…¨ã€æµç¨‹è§„èŒƒç­‰å…³é”®è¦ç‚¹ã€‚',
    category: 'ai-enterprise',
    date: '2025-01-05',
    readTime: '6åˆ†é’Ÿ',
    emoji: 'ğŸ›ï¸'
  },
  {
    id: 4,
    title: 'AIæ™ºèƒ½ä½“è½åœ°åï¼Œå¦‚ä½•è®©å›¢é˜ŸçœŸæ­£ç”¨èµ·æ¥ï¼Ÿ',
    description: 'AIå·¥å…·éƒ¨ç½²æˆåŠŸåªæ˜¯ç¬¬ä¸€æ­¥ï¼Œè®©å›¢é˜ŸçœŸæ­£ç”¨èµ·æ¥æ‰æ˜¯å…³é”®ã€‚åˆ†äº«å®ç”¨çš„åŸ¹è®­ä¸æ¨å¹¿æ–¹æ³•ã€‚',
    category: 'ai-enterprise',
    date: '2024-12-28',
    readTime: '4åˆ†é’Ÿ',
    emoji: 'ğŸ‘¥'
  },
  {
    id: 5,
    title: 'å¿ƒè„‘è¡€ç®¡å¥åº·ç®¡ç†ï¼šç”¨æ•°æ®ä»£æ›¿ç»éªŒï¼Œç²¾å‡†ç›‘æµ‹',
    description: 'å‘Šåˆ«"æ„Ÿè§‰å¼"å¥åº·ç®¡ç†ï¼Œç”¨æ•°æ®åŒ–æ€ç»´å»ºç«‹ç§‘å­¦çš„å¿ƒè„‘è¡€ç®¡å¥åº·ç›‘æµ‹ä½“ç³»ã€‚',
    category: 'health-cardiovascular',
    date: '2025-01-12',
    readTime: '5åˆ†é’Ÿ',
    emoji: 'â¤ï¸'
  },
  {
    id: 6,
    title: 'ä¸Šç­æ—å¿ƒè„‘è¡€ç®¡å¥åº·æ•°å­—åŒ–æ–¹æ¡ˆ',
    description: 'å·¥ä½œå¿™ç¢Œä¹Ÿèƒ½ç®¡ç†å¥½å¿ƒè„‘è¡€ç®¡å¥åº·ï¼Ÿè¿™å¥—æ•°å­—åŒ–æ–¹æ¡ˆä¸“ä¸ºä¸Šç­æ—è®¾è®¡ï¼Œæ¯å¤©åªéœ€5åˆ†é’Ÿã€‚',
    category: 'health-cardiovascular',
    date: '2025-01-08',
    readTime: '6åˆ†é’Ÿ',
    emoji: 'ğŸ’¼'
  },
  {
    id: 7,
    title: 'å¿ƒè„‘è¡€ç®¡æ…¢ç—…ç®¡ç†ï¼š3ä¸ªæ ¸å¿ƒæ•°æ®ï¼Œæ¯å¤©5åˆ†é’Ÿç›‘æµ‹',
    description: 'è¡€å‹ã€è¡€è„‚ã€å¿ƒç‡ï¼Œè¿™3ä¸ªæ•°æ®æ˜¯å¿ƒè„‘è¡€ç®¡å¥åº·çš„"æ™´é›¨è¡¨"ã€‚æ•™ä½ å¦‚ä½•æ­£ç¡®ç›‘æµ‹å’Œè®°å½•ã€‚',
    category: 'health-cardiovascular',
    date: '2025-01-03',
    readTime: '4åˆ†é’Ÿ',
    emoji: 'ğŸ“Š'
  },
  {
    id: 8,
    title: 'AIå·¥å…·åŠ æŒï¼Œè®©å¿ƒè„‘è¡€ç®¡å¥åº·ç›‘æµ‹æ›´é«˜æ•ˆ',
    description: 'AIå·¥å…·å¦‚ä½•å¸®åŠ©å¿ƒè„‘è¡€ç®¡å¥åº·ç®¡ç†ï¼Ÿåˆ†äº«å‡ æ¬¾å®ç”¨çš„å¥åº·ç›‘æµ‹å·¥å…·å’Œä½¿ç”¨æŠ€å·§ã€‚',
    category: 'health-cardiovascular',
    date: '2024-12-25',
    readTime: '5åˆ†é’Ÿ',
    emoji: 'ğŸ”¬'
  },
  {
    id: 9,
    title: 'ä¼ä¸šå‘˜å·¥å¿ƒè„‘è¡€ç®¡å¥åº·ç®¡ç†ï¼šAIæ™ºèƒ½ä½“çš„è½åœ°åº”ç”¨',
    description: 'å¦‚ä½•ç”¨AIæ™ºèƒ½ä½“å¸®åŠ©ä¼ä¸šå®ç°å‘˜å·¥å¿ƒè„‘è¡€ç®¡å¥åº·ç®¡ç†ï¼Ÿåˆ†äº«å®é™…é¡¹ç›®æ¡ˆä¾‹å’Œè½åœ°ç»éªŒã€‚',
    category: 'ai-health-fusion',
    date: '2025-01-14',
    readTime: '7åˆ†é’Ÿ',
    emoji: 'ğŸ¢'
  },
  {
    id: 10,
    title: 'å¤§å¥åº·æœºæ„å¦‚ä½•ç”¨AIæ™ºèƒ½ä½“æå‡å¥åº·ç®¡ç†æ•ˆç‡',
    description: 'å¥åº·æœºæ„å’¨è¯¢é‡å¤§ã€æ•ˆç‡ä½ï¼ŸAIæ™ºèƒ½ä½“å¯ä»¥è‡ªåŠ¨åŒ–å¤„ç†å¤§é‡å¸¸è§å¥åº·å’¨è¯¢ï¼Œé‡Šæ”¾äººåŠ›ã€‚',
    category: 'ai-health-fusion',
    date: '2025-01-06',
    readTime: '6åˆ†é’Ÿ',
    emoji: 'ğŸ¥'
  },
  {
    id: 11,
    title: 'æ•°æ®åŒ–æ€ç»´ï¼Œè®©AI+å¿ƒè„‘è¡€ç®¡å¥åº·ç®¡ç†æ›´æœ‰ç»“æœ',
    description: 'AIå’Œå¥åº·ç®¡ç†çš„ç»“åˆï¼Œæ ¸å¿ƒæ˜¯æ•°æ®åŒ–æ€ç»´ã€‚ç”¨æ•°æ®é©±åŠ¨å†³ç­–ï¼Œè®©å¥åº·ç®¡ç†æ›´ç§‘å­¦ã€‚',
    category: 'ai-health-fusion',
    date: '2024-12-20',
    readTime: '5åˆ†é’Ÿ',
    emoji: 'ğŸ’¡'
  }
];

const categories = [
  { id: 'all', label: 'å…¨éƒ¨', icon: 'ğŸ“š' },
  { id: 'ai-enterprise', label: 'ä¼ä¸šAI', color: 'accent' },
  { id: 'health-cardiovascular', label: 'å¥åº·ç®¡ç†', color: 'secondary' },
  { id: 'ai-health-fusion', label: 'AI+å¥åº·', color: 'primary' }
];
---

<section id="blog" class="section relative overflow-hidden">
  <!-- èƒŒæ™¯è£…é¥° -->
  <div class="absolute inset-0 bg-gradient-to-b from-surface to-background"></div>

  <div class="container relative z-10">
    <!-- æ ‡é¢˜ -->
    <div class="text-center mb-12">
      <span class="data-badge mb-4 inline-flex">åšå®¢ä¸“æ </span>
      <h2 class="section-title mb-3">åšå®¢æ–‡ç« </h2>
      <p class="section-subtitle">AIè½åœ°å¹²è´§ï¼Œå¥åº·ç®¡ç†æ–¹æ³•</p>
    </div>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <div class="flex flex-wrap justify-center gap-3 mb-10">
      {categories.map((cat, index) => (
        <button
          data-category={cat.id}
          class={`blog-category-btn flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-medium transition-all ${
            index === 0
              ? 'bg-accent text-white shadow-lg shadow-accent/30'
              : 'bg-surface border border-border text-text-secondary hover:border-accent hover:text-accent'
          }`}
        >
          <span>{cat.icon || (cat.color === 'accent' ? 'ğŸ¤–' : cat.color === 'secondary' ? 'â¤ï¸' : 'ğŸ”—')}</span>
          {cat.label}
        </button>
      ))}
    </div>

    <!-- åšå®¢å¡ç‰‡ç½‘æ ¼ -->
    <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {blogPosts.map((post) => (
        <article
          data-category={post.category}
          class="blog-card card group cursor-pointer"
        >
          <!-- é¡¶éƒ¨è£…é¥° -->
          <div class="flex items-start justify-between mb-4">
            <div class="text-3xl">{post.emoji}</div>
            <span class="data-badge">
              {post.category === 'ai-enterprise' ? 'ä¼ä¸šAI' :
               post.category === 'health-cardiovascular' ? 'å¥åº·ç®¡ç†' : 'AI+å¥åº·'}
            </span>
          </div>

          <!-- æ–‡ç« ä¿¡æ¯ -->
          <h3 class="text-base font-semibold text-text-primary mb-3 line-clamp-2 group-hover:text-accent transition-colors">
            {post.title}
          </h3>

          <p class="text-sm text-text-secondary line-clamp-2 mb-4">
            {post.description}
          </p>

          <!-- åº•éƒ¨ä¿¡æ¯ -->
          <div class="flex items-center justify-between pt-4 border-t border-border/50">
            <div class="flex items-center gap-3 text-xs text-text-secondary">
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                {post.date}
              </span>
              <span class="flex items-center gap-1">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {post.readTime}
              </span>
            </div>
            <span class="text-accent font-medium text-sm flex items-center gap-1 group-hover:gap-2 transition-all">
              é˜…è¯»å…¨æ–‡
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </span>
          </div>
        </article>
      ))}
    </div>

    <!-- æŸ¥çœ‹æ›´å¤š -->
    <div class="text-center mt-12">
      <button class="btn btn-outline px-8">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
        æŸ¥çœ‹æ›´å¤šæ–‡ç« 
      </button>
    </div>
  </div>
</section>

<script>
  // åˆ†ç±»ç­›é€‰åŠŸèƒ½
  const categoryBtns = document.querySelectorAll('.blog-category-btn');
  const blogCards = document.querySelectorAll('.blog-card');

  categoryBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');

      // æ›´æ–°æŒ‰é’®æ ·å¼
      categoryBtns.forEach((b) => {
        b.classList.remove('bg-accent', 'text-white', 'shadow-lg', 'shadow-accent/30');
        b.classList.add('bg-surface', 'border', 'border-border', 'text-text-secondary');
      });
      btn.classList.remove('bg-surface', 'border', 'border-border', 'text-text-secondary');
      btn.classList.add('bg-accent', 'text-white', 'shadow-lg', 'shadow-accent/30');

      // ç­›é€‰å¡ç‰‡
      blogCards.forEach((card) => {
        const cardCategory = card.getAttribute('data-category');
        if (category === 'all' || cardCategory === category) {
          (card as HTMLElement).style.display = 'block';
        } else {
          (card as HTMLElement).style.display = 'none';
        }
      });
    });
  });
</script>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

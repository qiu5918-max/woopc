---
import { CURRENT_SUBDOMAIN, API_BASE } from '../lib/tenant-config';

// ä» API è·å–ç§Ÿæˆ·é…ç½®
async function getSiteConfig() {
  try {
    const res = await fetch(`${API_BASE}/api/v1/public/${CURRENT_SUBDOMAIN}`, {
      headers: { 'Content-Type': 'application/json' }
    });
    if (!res.ok) return null;
    const data = await res.json();
    return data.data;
  } catch (error) {
    console.error('Failed to fetch site config:', error);
    return null;
  }
}

// ä» API è·å–æœåŠ¡æ•°æ®ï¼ˆç”¨äºç”Ÿæˆæ ¸å¿ƒèƒ½åŠ›ï¼‰
async function getServices() {
  try {
    const res = await fetch(`${API_BASE}/api/v1/public/${CURRENT_SUBDOMAIN}/services`, {
      headers: { 'Content-Type': 'application/json' }
    });
    if (!res.ok) return [];
    const data = await res.json();
    return data.data || [];
  } catch (error) {
    console.error('Failed to fetch services:', error);
    return [];
  }
}

// ä» API è·å–è£èª‰æ•°æ®
async function getHonors() {
  try {
    const res = await fetch(`${API_BASE}/api/v1/public/${CURRENT_SUBDOMAIN}/honors`, {
      headers: { 'Content-Type': 'application/json' }
    });
    if (!res.ok) return [];
    const data = await res.json();
    return data.data || [];
  } catch (error) {
    console.error('Failed to fetch honors:', error);
    return [];
  }
}

const siteConfig = await getSiteConfig();
const apiServices = await getServices();
const apiHonors = await getHonors();

// è£èª‰ç±»å‹ emoji æ˜ å°„
const honorTypeEmoji: Record<string, string> = {
  'CERTIFICATE': 'ğŸ†',
  'AWARD': 'ğŸ–ï¸',
  'PARTNERSHIP': 'ğŸ¤',
  'PATENT': 'ğŸ“œ',
  'OTHER': 'â­'
};

// é»˜è®¤æ ¸å¿ƒèƒ½åŠ›ï¼ˆé‚±å°äº®ï¼‰
const defaultCoreCapabilities = [
  {
    id: 'ai',
    title: 'ä¼ä¸šAIæ™ºèƒ½ä½“',
    subtitle: 'å®æ–½éƒ¨ç½²ä¸“å®¶',
    tagline: 'å®æˆ˜æ´¾ï¼Œè½åœ°ä¸ºæ ¸å¿ƒ',
    description: 'ä»éœ€æ±‚æ‹†è§£ â†’ æ–¹æ¡ˆå®šåˆ¶ â†’ æŠ€æœ¯è½åœ° â†’ æ•ˆæœå¤ç›˜ï¼Œå…¨æµç¨‹é—­ç¯',
    highlights: [
      { icon: 'ğŸ’¼', label: '17å¹´', text: 'AIäº§å“/æ”¿ä¼é¡¹ç›®å®æˆ˜' },
      { icon: 'ğŸ›ï¸', label: '10å¹´', text: 'æ”¿ä¼åˆä½œç»éªŒ' },
      { icon: 'ğŸ“', label: 'æŒè¯', text: 'ç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆ+æ•°æ®èµ„äº§ç®¡ç†å¸ˆ' },
      { icon: 'ğŸ‘¥', label: '90%+', text: 'AIåŸ¹è®­å­¦å‘˜æ»¡æ„åº¦' }
    ],
    color: 'accent'
  },
  {
    id: 'health',
    title: 'å¿ƒè„‘è¡€ç®¡å¥åº·',
    subtitle: 'æ•°å­—åŒ–ç®¡ç†å®è·µè€…',
    tagline: 'äº§å“åŒ–æ€ç»´ï¼Œæ•°æ®ä¸ºæ ¸å¿ƒ',
    description: 'æ•°æ®ç›‘æµ‹ â†’ é—®é¢˜åˆ†æ â†’ æ–¹æ¡ˆå®šåˆ¶ â†’ æ•ˆæœè¿½è¸ªï¼Œæ•°å­—åŒ–ç®¡ç†ä½“ç³»',
    highlights: [
      { icon: 'ğŸ¥', label: 'å¤šå¹´', text: 'å¤§å¥åº·æ…¢ç—…èµ›é“æ·±è€•' },
      { icon: 'ğŸ“Š', label: 'ä¸“ä¸š', text: 'æ•°æ®èµ„äº§ç®¡ç†å¸ˆèµ„è´¨' },
      { icon: 'ğŸ§ ', label: '17å¹´', text: 'äº§å“æ€ç»´æ²‰æ·€' },
      { icon: 'ğŸ”—', label: 'èåˆ', text: 'AI+å¥åº·å®è·µç»éªŒ' }
    ],
    color: 'secondary'
  }
];

// ä»æœåŠ¡æ•°æ®ç”Ÿæˆæ ¸å¿ƒèƒ½åŠ›
function generateCoreCapabilities(services: any[]) {
  if (services.length === 0) return defaultCoreCapabilities;

  return services.slice(0, 2).map((s: any, i: number) => ({
    id: s.slug || `service-${i}`,
    title: s.title,
    subtitle: s.subtitle || '',
    tagline: s.target?.substring(0, 20) || 'ä¸“ä¸šæœåŠ¡',
    description: s.value || '',
    highlights: (s.highlights || []).slice(0, 4).map((h: string, j: number) => ({
      icon: ['ğŸ’¼', 'ğŸ¥', 'ğŸ“Š', 'ğŸ”—'][j % 4],
      label: h.substring(0, 6),
      text: h
    })),
    color: i === 0 ? 'accent' : 'secondary'
  }));
}

const coreCapabilities = apiServices.length > 0
  ? generateCoreCapabilities(apiServices)
  : defaultCoreCapabilities;

// é»˜è®¤æˆå°±æ•°æ®ï¼ˆé‚±å°äº®ï¼‰
const defaultAchievements = [
  { value: '2500ä¸‡', label: 'æ•°å­—åŒ–è½¬å‹é¡¹ç›®', icon: 'ğŸ“ˆ' },
  { value: '672ä¸‡', label: 'æ™ºèƒ½ç³»ç»Ÿè½åœ°é¡¹ç›®', icon: 'ğŸ¤–' },
  { value: '30+', label: 'å›¢é˜Ÿç®¡ç†è§„æ¨¡', icon: 'ğŸ‘¥' },
  { value: 'TOP1', label: 'æ•°æ®è¦ç´ å¤§èµ›é‡‘èèµ›é“', icon: 'ğŸ†' }
];

// æ‹æ‹çš„æˆå°±æ•°æ®
const lianlianAchievements = [
  { value: '100+', label: 'æ·±åº¦æœåŠ¡å®¶åº­', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' },
  { value: '24å¹´', label: 'è¥¿é¤/ç”œå“ä¸»å¨ç»éªŒ', icon: 'ğŸ‘¨â€ğŸ³' },
  { value: '6å¹´', label: 'å¥³æ€§å¥åº·ç®¡ç†å®æˆ˜', icon: 'ğŸ’ª' },
  { value: '11å¹´', label: 'è¿ç»­åˆ›ä¸šç»éªŒ', icon: 'ğŸš€' }
];

// æ ¹æ®ç§Ÿæˆ·é€‰æ‹©æˆå°±æ•°æ®
const achievements = CURRENT_SUBDOMAIN === 'lianlian'
  ? lianlianAchievements
  : defaultAchievements;

// å¦‚æœ API æœ‰æ•°æ®åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
const credentials = apiHonors.length > 0 ? apiHonors.map((h: any) => ({
  icon: honorTypeEmoji[h.type] || 'ğŸ†',
  title: h.title,
  desc: h.description || h.issuer || ''
})) : [
  { icon: 'ğŸ—ï¸', title: 'ç³»ç»Ÿæ¶æ„å¸ˆ', desc: 'ç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆèµ„è´¨' },
  { icon: 'ğŸ’°', title: 'åŸºé‡‘ä»ä¸šèµ„æ ¼è¯', desc: 'åŸºé‡‘è¡Œä¸šä¸“ä¸šèµ„è´¨' },
  { icon: 'ğŸ“Š', title: 'æ•°æ®èµ„äº§ç®¡ç†å¸ˆ', desc: 'å…¨å›½é¦–æ‰¹è®¤è¯èµ„è´¨' },
  { icon: 'ğŸš€', title: 'æ¥¼å‹ä¼šåˆ›ä¸šå¯¼å¸ˆ', desc: 'åˆ›ä¸šæŒ‡å¯¼ä¸å­µåŒ–æœåŠ¡' },
  { icon: 'ğŸ›ï¸', title: 'æ•°å­—æ–‡æ—…ä¸“å®¶é¡¾é—®', desc: 'é‡åº†å¸‚æ–‡æ—…ç ”ç©¶ä¼šæ•°å­—æ–‡æ—…ä¸“å§”ä¼š' },
  { icon: 'ğŸï¸', title: 'æµ·å—å²›AIå¥åº·å¤§ä½¿', desc: 'AI+å¥åº·æ¨å¹¿å¤§ä½¿' }
];

// ç«™ç‚¹ä¿¡æ¯
const siteName = siteConfig?.name || 'é‚±å°äº®';
const siteDescription = siteConfig?.description || 'è®©AIè½åœ°ä¼ä¸šï¼Œè®©å¥åº·æœ‰æ•°æ®æ”¯æ’‘';
const sectionSubtitle = CURRENT_SUBDOMAIN === 'lianlian'
  ? 'ä»¥è‚ ä¸ºæ ¹ Â· ä»¥è½´ä¸ºæ ¸ Â· å®ˆæŠ¤åµå·¢ Â· è§„åˆ’ä¸€ç”Ÿå¥åº·'
  : 'è®©AIè½åœ°ä¼ä¸šï¼Œè®©å¥åº·æœ‰æ•°æ®æ”¯æ’‘';
---

<section id="about" class="section relative overflow-hidden">
  <!-- èƒŒæ™¯è£…é¥° -->
  <div class="absolute inset-0 bg-gradient-to-b from-background to-surface"></div>

  <div class="container relative z-10">
    <!-- æ ‡é¢˜ -->
    <div class="text-center mb-16">
      <span class="data-badge mb-4 inline-flex">å…³äºæˆ‘</span>
      <h2 class="section-title mb-3">æ ¸å¿ƒèƒ½åŠ›</h2>
      <p class="section-subtitle">{sectionSubtitle}</p>
    </div>

    <!-- åŒæ ¸å¿ƒèƒ½åŠ›å¡ç‰‡ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 mb-12">
      {coreCapabilities.map((capability) => (
        <div class="card group relative overflow-hidden">
          <!-- é¡¶éƒ¨æ¸å˜æ¡ -->
          <div class={`absolute top-0 left-0 right-0 h-1 ${
            capability.color === 'accent' ? 'bg-gradient-to-r from-accent to-purple-500' : 'bg-gradient-to-r from-secondary to-emerald-400'
          }`}></div>

          <!-- èƒ½åŠ›å¤´éƒ¨ -->
          <div class="flex items-start gap-4 mb-6">
            <div class={`icon-box ${capability.color === 'accent' ? '' : 'icon-box-secondary'}`}>
              {capability.id === 'ai' ? (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              ) : (
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              )}
            </div>
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <h3 class="text-xl font-bold text-text-primary">{capability.title}</h3>
              </div>
              <p class={`text-sm font-medium ${capability.color === 'accent' ? 'text-accent' : 'text-secondary'}`}>{capability.subtitle}</p>
            </div>
          </div>

          <!-- æ ‡è¯­ -->
          <div class="mb-6">
            <p class="text-sm text-text-secondary italic mb-2">{capability.tagline}</p>
            <p class="text-sm text-text-primary font-mono">{capability.description}</p>
          </div>

          <!-- å±¥å†äº®ç‚¹ -->
          <div class="grid grid-cols-2 gap-3">
            {capability.highlights.map((highlight) => (
              <div class="flex items-center gap-2 p-2 rounded-lg bg-background/50 dark:bg-slate-800/50">
                <span class="text-lg">{highlight.icon}</span>
                <div>
                  <span class={`text-sm font-bold ${capability.color === 'accent' ? 'text-accent' : 'text-secondary'}`}>{highlight.label}</span>
                  <span class="text-xs text-text-secondary block">{highlight.text}</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- æˆå°±æ•°æ® -->
    <div class="card mb-8">
      <h3 class="text-center text-sm font-semibold text-text-primary mb-6 flex items-center justify-center gap-2">
        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
        </svg>
        å®æˆ˜æˆå°±
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {achievements.map((achievement) => (
          <div class="text-center p-4 rounded-xl bg-gradient-to-br from-accent/5 to-purple-500/5 dark:from-accent/10 dark:to-purple-500/10">
            <span class="text-2xl mb-2 block">{achievement.icon}</span>
            <div class="stat-number text-2xl">{achievement.value}</div>
            <div class="stat-label">{achievement.label}</div>
          </div>
        ))}
      </div>
    </div>

    <!-- èµ„è´¨ä¸å¤´è¡” -->
    <div class="card">
      <h3 class="text-center text-sm font-semibold text-text-primary mb-6 flex items-center justify-center gap-2">
        <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
        </svg>
        èµ„è´¨ä¸å¤´è¡”
      </h3>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        {credentials.map((credential) => (
          <div class="flex items-center gap-3 p-3 rounded-xl bg-gradient-to-br from-accent/5 to-purple-500/5 dark:from-accent/10 dark:to-purple-500/10 hover:from-accent/10 hover:to-purple-500/10 transition-colors">
            <span class="text-2xl">{credential.icon}</span>
            <div>
              <p class="text-sm font-semibold text-text-primary">{credential.title}</p>
              <p class="text-xs text-text-secondary">{credential.desc}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>
